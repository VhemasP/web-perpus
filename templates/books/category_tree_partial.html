{% if node %}
<div class="category-item">
    <div class="flex items-center {% if not node.children %}pl-4{% endif %}">
        {% if node.children %}
        <button class="category-toggle p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md flex items-center w-full" data-category-id="{{ node.id }}">
            <svg class="w-4 h-4 mr-2 transform transition-transform duration-200 {% if node.id == selected_category %}rotate-90{% endif %}" 
                 fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
            <a href="?category={{ node.id }}" class="text-gray-700 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 {% if node.id == selected_category %}text-primary-600 font-semibold{% endif %}">
                {{ node.name }}
            </a>
        </button>
        {% else %}
        <a href="?category={{ node.id }}" class="text-gray-700 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 {% if node.id == selected_category %}text-primary-600 font-semibold{% endif %}">
            {{ node.name }}
        </a>
        {% endif %}
    </div>
    
    {% if node.children %}
    <div class="ml-6 mt-2 space-y-2 {% if node.id != selected_category %}hidden{% endif %}" data-parent="{{ node.id }}">
        {% for child in node.children %}
            {% include 'books/category_tree_partial.html' with node=child %}
        {% endfor %}
    </div>
    {% endif %}
</div>
{% endif %}
